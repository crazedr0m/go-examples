# Модульная архитектура для AMQP Subscriber

## Анализ текущей структуры
Текущее приложение представляет собой монолитный файл main.go, который содержит всю логику приложения:
1. Структуры конфигурации (Logger, RabbitMQ, Config)
2. Загрузку конфигурации из YAML-файла
3. Обработку переменных окружения
4. Управление жизненным циклом приложения (контекст, сигналы)
5. Подключение к RabbitMQ и обработку сообщений

## Предлагаемая модульная архитектура

### 1. Модуль конфигурации (config)
**Ответственность:** Загрузка, парсинг и предоставление конфигурации приложения
**Файлы:**
- `config/types.go` - структуры конфигурации (Logger, RabbitMQ, Config)
- `config/loader.go` - функции загрузки конфигурации из YAML и переменных окружения

### 2. Модуль RabbitMQ (amqp)
**Ответственность:** Подключение к RabbitMQ, объявление exchange/очередей, потребление сообщений
**Файлы:**
- `amqp/client.go` - клиент для работы с RabbitMQ
- `amqp/handler.go` - обработчик сообщений

### 3. Модуль приложения (app)
**Ответственность:** Управление жизненным циклом приложения, координация работы модулей
**Файлы:**
- `app/app.go` - основной координатор приложения
- `app/signals.go` - обработка сигналов операционной системы

### 4. Главный модуль (main)
**Ответственность:** Точка входа в приложение
**Файлы:**
- `main.go` - инициализация и запуск приложения

## Детальный план рефакторинга

### Этап 1: Создание структуры каталогов
```
ampq-subscriber/
├── config/
│   ├── types.go
│   └── loader.go
├── amqp/
│   ├── client.go
│   └── handler.go
├── app/
│   ├── app.go
│   └── signals.go
├── main.go
├── config.yml
├── go.mod
└── go.sum
```

### Этап 2: Перемещение структур конфигурации
- Перенести структуры Logger, RabbitMQ, Config в `config/types.go`
- Добавить комментарии на русском языке к структурам

### Этап 3: Создание загрузчика конфигурации
- Перенести логику загрузки YAML в `config/loader.go`
- Перенести логику обработки переменных окружения
- Создать единую функцию инициализации конфигурации

### Этап 4: Создание AMQP модуля
- Перенести логику подключения к RabbitMQ в `amqp/client.go`
- Перенести функцию messageHandler в `amqp/handler.go`
- Добавить обработку ошибок и логирование

### Этап 5: Создание модуля приложения
- Перенести логику управления контекстом в `app/app.go`
- Перенести обработку сигналов в `app/signals.go`
- Создать единую точку управления жизненным циклом

### Этап 6: Упрощение main.go
- Оставить только инициализацию и запуск приложения
- Подключить все модули
- Обеспечить правильную обработку ошибок

## Преимущества модульной архитектуры

1. **Разделение ответственностей** - каждый модуль имеет четко определенную область ответственности
2. **Повышение тестируемости** - модули можно тестировать изолированно
3. **Улучшение поддержки** - изменения в одном модуле не влияют на другие
4. **Повторное использование** - модули можно использовать в других проектах
5. **Масштабируемость** - легко добавлять новые функции в отдельные модули

Эта архитектура обеспечит четкое разделение логики приложения на отдельные модули с понятными интерфейсами между ними.